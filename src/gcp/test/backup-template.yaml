# GCP Cloud SQL Backup Test Template
#
# This template defines a Cloud SQL instance with backup configuration enabled
# for testing backup and restore operations.

namespace: gcp-backup-test

# =============================================================================
# Service Usage - Enable APIs
# =============================================================================

enable-sql-api:
  defines: gcp/service-usage
  apis:
    - sqladmin.googleapis.com
  services:
    data:
      protocol: custom

# =============================================================================
# Cloud SQL Instance with Backup Enabled
# =============================================================================

backup-sql-instance:
  defines: gcp/cloud-sql-instance
  name: backup-test-postgres
  database_version: POSTGRES_14
  tier: db-f1-micro
  region: us-central1
  allow_all: true
  storage_size_gb: 10
  # Backup configuration
  backup_start_time: "03:00"
  point_in_time_recovery_enabled: true
  depends:
    wait-for:
      runnables:
        - gcp-backup-test/enable-sql-api
      timeout: 300

