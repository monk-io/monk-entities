namespace: aws-iam-test

test-iam-policy:
  defines: aws-iam/iam-policy
  region: us-east-1
  policy_name: test-iam-policy-entity
  policy_description: "Test IAM policy for aws/iam entity integration testing"
  path: "/test/"
  policy_document:
    Version: "2012-10-17"
    Statement:
      - Sid: "S3ObjectAccess"
        Effect: Allow
        Action:
          - s3:GetObject
          - s3:PutObject
        Resource:
          - "arn:aws:s3:::monk-test-bucket/*"
      - Sid: "S3BucketAccess"
        Effect: Allow
        Action:
          - s3:ListBucket
        Resource:
          - "arn:aws:s3:::monk-test-bucket"
        Condition:
          StringEquals:
            "s3:prefix": ["public/", "uploads/"]
      - Sid: "CloudWatchLogsAccess"
        Effect: Allow
        Action:
          - logs:CreateLogGroup
          - logs:CreateLogStream
          - logs:PutLogEvents
        Resource:
          - "arn:aws:logs:us-east-1:*:log-group:/monk/test/*"
  tags:
    Environment: test
    Entity: aws-iam
    Purpose: integration-testing
    Owner: monk-framework

test-iam-user:
  defines: aws-iam/iam-user
  region: us-east-1
  user_name: test-iam-user-entity
  create_access_keys: true
  access_key_id_secret_ref: test-iam-user-access-key-id
  secret_access_key_secret_ref: test-iam-user-secret-access-key
  attached_policy_arns:
    - <- connection-target("test-policy") entity-state get-member("policy_arn")
  connections:
    test-policy:
      runnable: aws-iam-test/test-iam-policy
      service: policy
  depends:
    wait-for:
      runnables:
        - aws-iam-test/test-iam-policy
      timeout: 60
  tags:
    Environment: test
    Entity: aws-iam
    Purpose: integration-testing
    Owner: monk-framework

test-iam-user-standalone:
  defines: aws-iam/iam-user
  region: us-east-1
  user_name: test-iam-standalone-user
  create_access_keys: true
  tags:
    Environment: test
    Entity: aws-iam
    Purpose: standalone-testing
    Owner: monk-framework