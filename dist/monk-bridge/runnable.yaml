namespace: monk-bridge
runnable:
  defines: entity
  metadata:
    name: Runnable
    description: |-
      Monk Bridge Runnable entity.
      Connects to remote Monk clusters and retrieves runnable information.
      Enables cross-cluster resource visibility and management.

      ## Secrets
      - Reads: `monkcode_secret_ref` - Monk cluster connection code
      - Writes: none

      ## State Fields for Composition
      - `state.endpoints` - Public endpoints of the runnable
      - `state.is_run` - Whether the runnable is currently running

      ## Composing with Other Entities
      Works with:
      - `monk-bridge/cluster` - Remote cluster connection
    version-hash: 50314a573457
  schema:
    monkcode_secret_ref:
      type: string
    allowed_methods:
      type: array
      items:
        type: string
    runnable:
      type: string
    required:
      - monkcode_secret_ref
      - runnable
  state-schema:
    last_synced_at:
      type: number
    runnable:
      type: string
    template:
      type: string
    instance_ids:
      type: array
      items:
        type: string
    is_run:
      type: boolean
    endpoints:
      type: array
      items:
        type: object
        properties:
          source:
            type: string
            enum:
              - balancer
              - container
          name:
            type: string
          address:
            type: string
          port:
            type: string
          healthy:
            type: boolean
          raw: {}
        required:
          - source
          - name
        additionalProperties: false
  lifecycle:
    sync: <<< runnable-sync.js
    refresh: ''
    describe: ''
  requires:
    - monkec/base
    - cli
    - monk-bridge/monk-bridge-base
