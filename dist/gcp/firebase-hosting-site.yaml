namespace: gcp
firebase-hosting-site:
  defines: entity
  metadata:
    name: FirebaseHostingSite
    description: |-
      GCP Firebase Hosting Site Entity

      Manages Firebase Hosting sites which serve web applications. Each site
      has a default domain ({site}.web.app) and can have custom domains configured.

      ## Site Deployment
      This entity creates and manages the site resource. To deploy content:
      - Use Firebase CLI in a container: `firebase deploy --only hosting`
      - Use the Firebase Hosting Channel entity for preview deployments
      - Or use the deploy action with blob content

      ## Builder Pattern
      For deploying content, combine this entity with a runnable that uses
      Firebase CLI:
      ```yaml
      hosting-deploy:
        defines: runnable
        containers:
          deploy:
            image: node:20
            bash: firebase deploy --only hosting --project=$PROJECT
            paths:
              - <- `blobs://my-site-content:/app`
      ```

      ## Secrets
      This entity does NOT write any secrets directly.

      ## Dependencies
      Required APIs:
      - `firebasehosting.googleapis.com`

      ## State Fields for Composition
      - `state.default_url` - Default URL ({site}.web.app)
      - `state.firebase_app_url` - Legacy URL ({site}.firebaseapp.com)
      - `state.site_id` - Site ID for use in other API calls
      - `state.name` - Full resource name

      ## Composing with Other Entities
      - `gcp/firebase-hosting-channel` - Create preview channels
      - `gcp/service-usage` - Enable firebasehosting.googleapis.com
    version-hash: d95a4277ce84
  schema:
    project:
      type: string
      description: 'Override the GCP project ID (optional, defaults to environment)'
    name:
      type: string
      description: |-
        Site name/ID (must be unique within Firebase project)
        The site will be accessible at {name}.web.app and {name}.firebaseapp.com
    firebase_project:
      type: string
      description: |-
        Firebase project ID (if different from GCP project)
        Usually the same as the GCP project.
    site_type:
      type: string
      enum:
        - DEFAULT_SITE
        - USER_SITE
      description: |-
        Site type
        - DEFAULT_SITE: The default hosting site for the project
        - USER_SITE: A custom additional hosting site
      default: USER_SITE
    app_id:
      type: string
      description: |-
        App ID this site is associated with (optional)
        Format: projects/{project}/webApps/{appId}
    keep_on_delete:
      type: boolean
      description: Whether to keep the site on delete (don't destroy)
      default: false
    labels:
      type: object
      additionalProperties:
        type: string
        description: Key-value labels for organizing sites
      description: Key-value labels for organizing sites
    required:
      - name
  state-schema:
    existing:
      type: boolean
      description: Indicates if the resource already existed before this entity managed it
    operation_name:
      type: string
      description: Operation name for tracking long-running operations
    name:
      type: string
      description: Full resource name
    site_id:
      type: string
      description: Site ID
    default_url:
      type: string
      description: 'Default URL for the site ({site}.web.app)'
    site_type:
      type: string
      description: Site type
    app_id:
      type: string
      description: Associated app ID
    firebase_app_url:
      type: string
      description: 'Legacy Firebase app domain ({site}.firebaseapp.com)'
  lifecycle:
    sync: <<< firebase-hosting-site-sync.js
    get: ''
    list-channels: ''
    list-releases: ''
    list-versions: ''
    list-domains: ''
  checks:
    readiness:
      period: 5
      initialDelay: 2
      attempts: 10
    liveness:
      period: 300
  requires:
    - monkec/base
    - gcp/gcp-base
    - cli
    - gcp/common
