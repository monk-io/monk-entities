namespace: gcp
cloud-sql-database:
  defines: entity
  metadata:
    name: CloudSqlDatabase
    description: |-
      Cloud SQL Database entity

      Creates a database within an existing Cloud SQL instance.

      ## Secrets
      This entity does NOT write any secrets.

      ## Dependencies
      - **REQUIRED**: `gcp/cloud-sql-instance` - Must be created first
      - Pass the instance name via `instance` field (from instance's `definition.name`)

      ## State Fields for Composition
      The following state fields can be used by other entities:
      - `state.name` - Database name for connection strings
      - `state.self_link` - Full resource URL

      ## Definition Fields from Other Entities
      - `instance` - Get from `gcp/cloud-sql-instance` entity's `definition.name`
    version-hash: 8ed7b70e7799
  schema:
    project:
      type: string
      description: 'Override the GCP project ID (optional, defaults to environment)'
    instance:
      type: string
      description: Name of the parent Cloud SQL instance
    name:
      type: string
      description: Name of the database to create
    charset:
      type: string
      description: 'Character set for the database (e.g., UTF8)'
    collation:
      type: string
      description: Collation for the database
    required:
      - instance
      - name
  state-schema:
    existing:
      type: boolean
      description: Indicates if the resource already existed before this entity managed it
    operation_name:
      type: string
      description: Operation name for tracking long-running operations
    name:
      type: string
      description: Name of the database
    self_link:
      type: string
      description: Self-link URL
  lifecycle:
    sync: <<< cloud-sql-database-sync.js
  checks:
    readiness:
      period: 5
      initialDelay: 2
      attempts: 20
    liveness:
      period: 300
  requires:
    - gcp/gcp-base
    - cli
    - helpers
    - gcp/common
