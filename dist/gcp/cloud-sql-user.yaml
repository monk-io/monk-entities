namespace: gcp
cloud-sql-user:
  defines: entity
  metadata:
    name: CloudSqlUser
    version-hash: d87fc5c5f384
  schema:
    project:
      type: string
      description: 'Override the GCP project ID (optional, defaults to environment)'
    instance:
      type: string
      description: Name of the parent Cloud SQL instance
    name:
      type: string
      description: Username for the database user
    password_secret:
      type: string
      description: Secret reference name to store/retrieve the password
    host:
      type: string
      description: 'Host restriction for the user (MySQL only, % for any host)'
    user_type:
      type: string
      description: 'User type (BUILT_IN, CLOUD_IAM_USER, CLOUD_IAM_SERVICE_ACCOUNT)'
      default: BUILT_IN
    required:
      - instance
      - name
      - password_secret
  state-schema:
    existing:
      type: boolean
      description: Indicates if the resource already existed before this entity managed it
    operation_name:
      type: string
      description: Operation name for tracking long-running operations
    name:
      type: string
      description: Username
    host:
      type: string
      description: Host restriction
  lifecycle:
    sync: <<< cloud-sql-user-sync.js
  checks:
    readiness:
      period: 5
      initialDelay: 2
      attempts: 20
    liveness:
      period: 300
  requires:
    - gcp/gcp-base
    - secret
    - cli
    - gcp/common
