namespace: gcp
cloud-sql-instance:
  defines: entity
  metadata:
    name: CloudSqlInstance
    version-hash: d87fc5c5f384
  schema:
    project:
      type: string
      description: 'Override the GCP project ID (optional, defaults to environment)'
    name:
      type: string
      description: Name of the Cloud SQL instance (must be unique within the project)
    database_version:
      type: string
      enum:
        - MYSQL_5_6
        - MYSQL_5_7
        - MYSQL_8_0
        - MYSQL_8_0_18
        - MYSQL_8_0_26
        - MYSQL_8_0_27
        - MYSQL_8_0_28
        - MYSQL_8_0_30
        - MYSQL_8_0_31
        - MYSQL_8_0_32
        - MYSQL_8_0_33
        - MYSQL_8_0_34
        - MYSQL_8_0_35
        - MYSQL_8_0_36
        - MYSQL_8_0_37
        - MYSQL_8_0_38
        - MYSQL_8_0_39
        - MYSQL_8_0_40
        - MYSQL_8_0_41
        - MYSQL_8_0_42
        - MYSQL_8_0_43
        - MYSQL_8_0_44
        - MYSQL_8_4
        - POSTGRES_9_6
        - POSTGRES_10
        - POSTGRES_11
        - POSTGRES_12
        - POSTGRES_13
        - POSTGRES_14
        - POSTGRES_15
        - POSTGRES_16
        - POSTGRES_17
        - POSTGRES_18
        - SQLSERVER_2017_STANDARD
        - SQLSERVER_2017_ENTERPRISE
        - SQLSERVER_2017_EXPRESS
        - SQLSERVER_2017_WEB
        - SQLSERVER_2019_STANDARD
        - SQLSERVER_2019_ENTERPRISE
        - SQLSERVER_2019_EXPRESS
        - SQLSERVER_2019_WEB
        - SQLSERVER_2022_STANDARD
        - SQLSERVER_2022_ENTERPRISE
        - SQLSERVER_2022_EXPRESS
        - SQLSERVER_2022_WEB
      description: Database version
      default: POSTGRES_14
    tier:
      type: string
      description: Machine tier for the instance
      default: db-f1-micro
    region:
      type: string
      description: GCP region for the instance
      default: us-central1
    allow_all:
      type: boolean
      description: Allow connections from any IP address (0.0.0.0/0) - use with caution
      default: false
    root_password:
      type: string
      description: >-
        Root password for the instance (optional, generates random if not
        provided)
    deletion_protection:
      type: boolean
      description: Enable deletion protection
      default: false
    storage_type:
      type: string
      description: Storage type (PD_SSD or PD_HDD)
      default: PD_SSD
    storage_size_gb:
      type: number
      description: Initial storage size in GB
      default: 10
    storage_auto_resize:
      type: boolean
      description: Enable storage auto-resize
      default: true
    binary_log_enabled:
      type: boolean
      description: Enable binary logging (for MySQL replication)
      default: false
    point_in_time_recovery_enabled:
      type: boolean
      description: Enable point-in-time recovery
      default: false
    backup_start_time:
      type: string
      description: 'Backup start time in HH:MM format (24-hour)'
    availability_type:
      type: string
      description: Availability type (ZONAL or REGIONAL)
      default: ZONAL
    required:
      - name
  state-schema:
    existing:
      type: boolean
      description: Indicates if the resource already existed before this entity managed it
    operation_name:
      type: string
      description: Operation name for tracking long-running operations
    address:
      type: string
      description: Public IP address of the instance
    port:
      type: number
      description: Database port
    connection_name:
      type: string
      description: 'Instance connection name (project:region:instance)'
    self_link:
      type: string
      description: Instance self-link URL
    instance_state:
      type: string
      description: 'Instance state (RUNNABLE, SUSPENDED, etc.)'
    database_version:
      type: string
      description: Database version that was created
  lifecycle:
    sync: <<< cloud-sql-instance-sync.js
    get-info: ''
    restart: ''
    stop: ''
    start: ''
    get-backup-info: ''
    create-backup: ''
    list-backups: ''
    describe-backup: ''
    delete-backup: ''
    restore: ''
    get-restore-status: ''
  checks:
    readiness:
      period: 15
      initialDelay: 10
      attempts: 80
    liveness:
      period: 300
  requires:
    - monkec/base
    - gcp/gcp-base
    - cli
    - gcp/common
