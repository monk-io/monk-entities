namespace: stripe
credentials:
  defines: entity
  metadata:
    name: Credentials
    description: |-
      Stripe Credentials entity.
      Validates and manages Stripe API credentials.
      Verifies the API key and provides account information.

      ## Secrets
      - Reads: secret name from `secret_ref` property - Stripe API key (defaults to `stripe-api-key`)
      - Writes: none

      ## State Fields for Composition
      - `state.account_id` - Stripe account ID (acct_...)
      - `state.mode` - API mode ("test" or "live")
      - `state.publishable_key` - Publishable key for client-side use
      - `state.secret_ref` - Original secret ref name for consumers to read via secret()

      ## Consuming Credentials in Runnables
      ```yaml
      app:
        defines: runnable
        connections:
          stripe:
            target: my-namespace/stripe-creds
            service: data
        variables:
          stripe_secret_ref:
            type: string
            value: <- connection-target("stripe") entity get-member("secret_ref")
          STRIPE_SECRET_KEY:
            env: STRIPE_SECRET_KEY
            type: string
            value: <- secret($stripe_secret_ref)
          STRIPE_PUBLISHABLE_KEY:
            env: STRIPE_PUBLISHABLE_KEY
            type: string
            value: <- connection-target("stripe") entity-state get-member("publishable_key")
      ```

      ## Composing with Other Entities
      Validates credentials for use with:
      - `stripe/product` - Product management
      - `stripe/price` - Price management
      - `stripe/webhook-endpoint` - Webhook configuration
    version-hash: c326f768f517
  schema:
    secret_ref:
      type: string
      minLength: 1
      maxLength: 64
      description: Secret name storing Stripe secret API key (sk_test_... or sk_live_...)
    publishable_key:
      type: string
      description: 'Optional publishable key (pk_test_... or pk_live_...), for convenience'
    required:
      - secret_ref
  state-schema:
    existing:
      type: boolean
      description: Indicates if the resource already existed before this entity managed it
    account_id:
      type: string
    mode:
      type: string
      enum:
        - test
        - live
    publishable_key:
      type: string
    secret_ref:
      type: string
  lifecycle:
    sync: <<< credentials-sync.js
  checks:
    readiness:
      period: 10
      initialDelay: 1
      attempts: 12
  requires:
    - stripe/stripe-base
    - cli
