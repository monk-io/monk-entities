
// Generated by MonkEC - targeting Goja runtime
var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });

// input/stripe/product.ts
const stripeBase = require("stripe/stripe-base");
const StripeEntity = stripeBase.StripeEntity;
const cli = require("cli");
var _Product = class _Product extends StripeEntity {
  getEntityName() {
    return this.definition.name;
  }
  create() {
    if (this.definition.product_id) {
      const p = this.makeRequest("GET", `/products/${this.definition.product_id}`);
      this.state = { product_id: p?.id, name: p?.name, existing: true };
      cli.output(`\u2139\uFE0F Adopted existing Stripe product ${p?.id}`);
      return;
    }
    let found = null;
    try {
      const list = this.makeRequest("GET", "/products?limit=100");
      const items = Array.isArray(list?.data) ? list.data : [];
      found = items.find((it) => it.name === this.definition.name);
    } catch {
    }
    if (found) {
      this.state = { product_id: found.id, name: found.name, existing: true };
      cli.output(`\u2139\uFE0F Reusing existing Stripe product ${found.id}`);
      return;
    }
    const params = { name: this.definition.name };
    if (this.definition.product_description) params["description"] = this.definition.product_description;
    if (this.definition.metadata) {
      for (const [k, v] of Object.entries(this.definition.metadata)) {
        params[`metadata[${k}]`] = v;
      }
    }
    const created = this.makeRequest("POST", "/products", params);
    this.state = { product_id: created?.id, name: created?.name, existing: false };
    cli.output(`\u2705 Created Stripe product ${created?.id}`);
  }
  update() {
    if (!this.state?.product_id) {
      this.create();
      return;
    }
    const params = {};
    if (this.definition.product_description) params["description"] = this.definition.product_description;
    if (this.definition.metadata) {
      for (const [k, v] of Object.entries(this.definition.metadata)) {
        params[`metadata[${k}]`] = v;
      }
    }
    if (Object.keys(params).length > 0) {
      const updated = this.makeRequest("POST", `/products/${this.state.product_id}`, params);
      this.state = { ...this.state, name: updated?.name };
      cli.output(`\u{1F504} Updated Stripe product ${this.state.product_id}`);
    }
  }
  delete() {
    if (!this.state?.product_id || this.state.existing) return;
    try {
      this.makeRequest("DELETE", `/products/${this.state.product_id}`);
      cli.output(`\u{1F5D1}\uFE0F Deleted Stripe product ${this.state.product_id}`);
    } catch {
    }
  }
  checkReadiness() {
    return Boolean(this.state?.product_id);
  }
};
__name(_Product, "Product");
var Product = _Product;



function main(def, state, ctx) {
  const entity = new Product(def, state, ctx);
  return entity.main(ctx);
}
