namespace: stripe
price:
  defines: entity
  metadata:
    name: Price
    description: |-
      Stripe Price entity.
      Creates and manages Stripe prices for products.
      Prices define how much and how often to charge for products.

      ## Secrets
      - Reads: secret name from `secret_ref` property - Stripe API key (defaults to `stripe-api-key`)
      - Writes: none

      ## State Fields for Composition
      - `state.price_id` - Stripe price ID (price_...)
      - `state.lookup_key` - Price lookup key for easy reference

      ## Using Price in Runnables
      ```yaml
      app:
        defines: runnable
        connections:
          price:
            target: my-namespace/price
            service: data
        variables:
          STRIPE_PRICE_ID:
            env: STRIPE_PRICE_ID
            type: string
            value: <- connection-target("price") entity-state get-member("price_id")
      ```

      ## Composing with Other Entities
      Works with:
      - `stripe/product` - The product this price is for
    version-hash: c326f768f517
  schema:
    secret_ref:
      type: string
      minLength: 1
      maxLength: 64
      description: Secret name storing Stripe secret API key (sk_test_... or sk_live_...)
    lookup_key:
      type: string
    currency:
      type: string
    unit_amount:
      type: number
    recurring_interval:
      type: string
      enum:
        - day
        - week
        - month
        - year
    product_id:
      type: string
    price_id:
      type: string
    required:
      - secret_ref
  state-schema:
    existing:
      type: boolean
      description: Indicates if the resource already existed before this entity managed it
    price_id:
      type: string
    lookup_key:
      type: string
  lifecycle:
    sync: <<< price-sync.js
  checks:
    readiness:
      period: 10
      initialDelay: 1
      attempts: 12
  requires:
    - stripe/stripe-base
    - cli
