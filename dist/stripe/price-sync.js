
// Generated by MonkEC - targeting Goja runtime
var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });

// input/stripe/price.ts
const stripeBase = require("stripe/stripe-base");
const StripeEntity = stripeBase.StripeEntity;
const cli = require("cli");
var _Price = class _Price extends StripeEntity {
  getEntityName() {
    return this.state?.price_id || (this.definition.lookup_key || "stripe-price");
  }
  create() {
    if (this.definition.price_id) {
      const pr = this.makeRequest("GET", `/prices/${this.definition.price_id}`);
      this.state = { price_id: pr?.id, lookup_key: pr?.lookup_key, existing: true };
      cli.output(`\u2139\uFE0F Adopted existing Stripe price ${pr?.id}`);
      return;
    }
    if (this.definition.lookup_key) {
      const list = this.makeRequest("GET", `/prices?lookup_keys[]=${encodeURIComponent(this.definition.lookup_key)}&active=true&limit=1`);
      const pr = Array.isArray(list?.data) && list.data.length > 0 ? list.data[0] : null;
      if (pr) {
        this.state = { price_id: pr.id, lookup_key: pr.lookup_key, existing: true };
        cli.output(`\u2139\uFE0F Resolved Stripe price by lookup_key ${this.definition.lookup_key}: ${pr.id}`);
        return;
      }
    }
    if (!this.definition.currency || !this.definition.unit_amount) {
      throw new Error("To create a price, currency and unit_amount are required");
    }
    const productId = this.definition.product_id;
    if (!productId) {
      throw new Error("To create a price, product_id is required");
    }
    const params = {
      currency: this.definition.currency,
      unit_amount: String(this.definition.unit_amount)
    };
    if (this.definition.recurring_interval) {
      params["recurring[interval]"] = this.definition.recurring_interval;
    }
    params["product"] = productId;
    if (this.definition.lookup_key) {
      params["lookup_key"] = this.definition.lookup_key;
    }
    const created = this.makeRequest("POST", "/prices", params);
    this.state = { price_id: created?.id, lookup_key: created?.lookup_key, existing: false };
    cli.output(`\u2705 Created Stripe price ${created?.id}`);
  }
  update() {
    if (!this.state?.price_id) {
      this.create();
      return;
    }
  }
  delete() {
  }
  checkReadiness() {
    return Boolean(this.state?.price_id);
  }
};
__name(_Price, "Price");
var Price = _Price;



function main(def, state, ctx) {
  const entity = new Price(def, state, ctx);
  return entity.main(ctx);
}
