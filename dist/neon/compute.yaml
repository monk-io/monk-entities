namespace: neon
compute:
  defines: entity
  metadata:
    name: Compute
  schema:
    secret_ref:
      type: string
      minLength: 1
      maxLength: 24
    project-id:
      type: string
      description: 'The Neon project ID (format: project-name-123456)'
    branch-id:
      type: string
      description: 'The Neon branch ID (format: br-name-123456)'
    compute-type:
      type: string
      enum:
        - read_write
        - read_only
      description: Whether this is a read-write or read-only compute
      default: read_write
    min-cu:
      type: number
      description: Minimum compute units for autoscaling
      default: 1
    max-cu:
      type: number
      description: Maximum compute units for autoscaling
      default: 1
    pooler-enabled:
      type: boolean
      description: Enable connection pooler for the compute
      default: false
    pooler-mode:
      type: string
      enum:
        - transaction
        - session
      description: Mode for the connection pooler
      default: transaction
    required:
      - secret_ref
      - projectId
      - branchId
  state-schema:
    existing:
      type: boolean
    id:
      type: string
      description: 'Unique identifier for the compute (format: ep-name-123456)'
    host:
      type: string
      description: Hostname for connecting to the compute
    proxyHost:
      type: string
      description: Proxy hostname for connecting to the compute
    currentState:
      type: string
      description: 'Current state of the compute (active, idle, etc)'
    pendingState:
      type: string
      description: Pending state if compute is transitioning
    createdAt:
      type: string
      format: date-time
      description: When the compute was created
    updatedAt:
      type: string
      format: date-time
      description: When the compute was last updated
    lastActive:
      type: string
      format: date-time
      description: When the compute was last active
    disabled:
      type: boolean
      description: 'If true, compute is disabled'
    operationId:
      type: string
      description: ID of the operation that created the compute
  lifecycle:
    sync: <<< compute-sync.js
    restart-compute: ''
    get-compute-details: ''
  checks:
    readiness:
      period: 15
      initialDelay: 2
      attempts: 20
  requires:
    - monkec/base
    - neon/neon-base
    - cli
