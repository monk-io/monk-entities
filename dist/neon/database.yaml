namespace: neon
database:
  defines: entity
  metadata:
    name: Database
    description: |-
      Neon Database entity.
      Creates and manages PostgreSQL databases within a Neon branch.
      Each database is a logical container for schemas, tables, and data.

      ## Secrets
      - Reads: secret name from `secret_ref` property - Neon API key (defaults to `neon-api-key`)
      - Writes: none

      ## State Fields for Composition
      - `state.id` - Database ID
      - `state.name` - Database name
      - `state.owner` - Database owner role

      ## Composing with Other Entities
      Works with:
      - `neon/project` - The project containing this database
      - `neon/branch` - The branch this database resides on
      - `neon/role` - Database roles for access control
    version-hash: b9e9da8541b6
  schema:
    secret_ref:
      type: string
      description: Secret name for Neon API authentication
    name:
      type: string
      description: Name of the database to create
    project-id:
      type: string
      description: 'The Neon project ID (format: project-name-123456)'
    branch-id:
      type: string
      description: 'The Neon branch ID (format: br-name-123456)'
    owner-name:
      type: string
      description: 'Name of the role that will own the database (optional, defaults to project owner)'
    required:
      - secret_ref
      - name
      - projectId
      - branchId
  state-schema:
    id:
      type: number
      description: Unique identifier for the database
    name:
      type: string
      description: Current name of the database
    branchId:
      type: string
      description: ID of the branch containing this database
    ownerName:
      type: string
      description: Name of the role that owns the database
    createdAt:
      type: string
      format: date-time
      description: When the database was created
    updatedAt:
      type: string
      format: date-time
      description: When the database was last updated
    operationId:
      type: string
      description: ID of the current operation
  lifecycle:
    sync: <<< database-sync.js
    update-database: ''
  checks:
    readiness:
      period: 5
      initialDelay: 2
      attempts: 10
    liveness:
      period: 300
  requires:
    - monkec/base
    - secret
    - http
