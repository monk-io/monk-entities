namespace: aws-ses
ses-email-identity:
  defines: entity
  metadata:
    name: SESEmailIdentity
    description: |-
      AWS SES Email Identity entity.
      Creates and manages Amazon SES email identities for sending emails.
      Sends verification email to the address and manages DKIM configuration.

      ## Secrets
      - Reads: none (authenticated via AWS provider)
      - Writes: none

      ## Verification
      After creation, the email address owner must click the verification link.
      Check `state.verification_status` for current status (PENDING, SUCCESS, FAILED).

      ## State Fields for Composition
      - `state.email_address` - Verified email address for sending
      - `state.verified` - Whether the identity is verified and ready for sending
      - `state.dkim_tokens` - DKIM tokens for DNS configuration

      ## Composing with Other Entities
      Works with:
      - `aws-ses/configuration-set` - Associate with configuration set for tracking
      - `aws-lambda/function` - Send emails from serverless functions
    version-hash: 110a78540381
  schema:
    region:
      type: string
      description: AWS region for SES operations
    email_address:
      type: string
      description: Email address to verify and use for sending
    dkim_signing_enabled:
      type: boolean
      description: Enable DKIM signing for this email identity
    configuration_set_name:
      type: string
      description: Configuration set name to associate with this identity
    required:
      - region
      - email_address
  state-schema:
    existing:
      type: boolean
      description: Indicates if the resource pre-existed before this entity managed it
    email_address:
      type: string
      description: Email address identity
    verification_status:
      type: string
      enum:
        - PENDING
        - SUCCESS
        - FAILED
        - TEMPORARY_FAILURE
        - NOT_STARTED
      description: Current verification status
    verified:
      type: boolean
      description: Whether the identity is verified
    dkim_status:
      type: string
      description: DKIM signing status
    dkim_tokens:
      type: array
      items:
        type: string
      description: DKIM tokens for DNS configuration
    required:
      - existing
  lifecycle:
    sync: <<< ses-email-identity-sync.js
    get-verification-status: ''
    send-test-email: ''
    get-dkim-tokens: ''
  checks:
    readiness:
      period: 10
      initialDelay: 5
      attempts: 30
    liveness:
      period: 300
  requires:
    - aws-ses/base
    - monkec/base
    - cli
    - aws-ses/common
