namespace: digitalocean-monitoring
digital-ocean-monitoring:
  defines: entity
  metadata:
    name: DigitalOceanMonitoring
    version-hash: 79c42885f803
  schema:
    create_when_missing:
      type: boolean
      description: >-
        Controls whether to create resources when they don't exist (default:
        true)
    name:
      type: string
      description: Unique name for the alert policy
    metric_type:
      type: string
      enum:
        - v1/insights/droplet/cpu
        - v1/insights/droplet/load_1
        - v1/insights/droplet/load_5
        - v1/insights/droplet/load_15
        - v1/insights/droplet/memory_utilization_percent
        - v1/insights/droplet/disk_utilization_percent
        - v1/insights/droplet/disk_read
        - v1/insights/droplet/disk_write
        - v1/insights/droplet/public_outbound_bandwidth
        - v1/insights/droplet/public_inbound_bandwidth
        - v1/insights/droplet/private_outbound_bandwidth
        - v1/insights/droplet/private_inbound_bandwidth
      description: 'Type of metric to monitor (e.g., v1/insights/droplet/cpu)'
    compare:
      type: string
      enum:
        - GreaterThan
        - LessThan
      description: How to compare the metric value (GreaterThan or LessThan)
    value:
      type: number
      description: The threshold value for the alert
    window:
      type: string
      enum:
        - 5m
        - 10m
        - 30m
        - 1h
      description: 'Time window for metric evaluation (5m, 10m, 30m, 1h)'
    alert_description:
      type: string
      description: >-
        Optional description of the alert policy (auto-generated if not
        provided)
    emails:
      type: array
      items:
        type: string
      description: Array of email addresses (auto-detected from account if not provided)
    entities:
      type: array
      items:
        type: string
      description: Array of specific Droplet IDs to monitor
    tags:
      type: array
      items:
        type: string
      description: Array of tags to match Droplets for monitoring
    slack_channels:
      type: array
      items:
        type: object
        properties:
          channel:
            type: string
          url:
            type: string
        required:
          - channel
          - url
        additionalProperties: false
      description: Array of Slack webhook configurations for notifications
    enabled:
      type: boolean
      description: 'Whether the alert policy is enabled (default: true)'
    required:
      - name
      - metric_type
      - compare
      - value
      - window
  state-schema:
    existing:
      type: boolean
    uuid:
      type: string
    name:
      type: string
    type:
      type: string
    description:
      type: string
    compare:
      type: string
    value:
      type: number
    window:
      type: string
    entities:
      type: array
      items:
        type: string
    tags:
      type: array
      items:
        type: string
    alerts:
      type: object
      properties:
        email:
          type: array
          items:
            type: string
        slack:
          type: array
          items:
            type: object
            properties:
              channel:
                type: string
              url:
                type: string
            required:
              - channel
              - url
            additionalProperties: false
      additionalProperties: false
    enabled:
      type: boolean
    created_at:
      type: string
  lifecycle:
    sync: <<< digital-ocean-monitoring-sync.js
    list-alert-policies: ''
    get-alert-policy: ''
    enable-alert-policy: ''
    disable-alert-policy: ''
    list-sinks: ''
    get-sink: ''
    get-account-info: ''
    get-droplet-metrics: ''
    get-droplet-cpu-metrics: ''
    get-droplet-memory-metrics: ''
    get-droplet-disk-metrics: ''
    get-droplet-network-metrics: ''
    get-droplet-bandwidth-inbound: ''
    get-droplet-bandwidth-outbound: ''
    get-droplet-private-bandwidth-inbound: ''
    get-droplet-private-bandwidth-outbound: ''
    get-droplet-disk-read: ''
    get-droplet-disk-write: ''
    get-droplet-load-average-1: ''
    get-droplet-load-average-5: ''
    get-droplet-load-average-15: ''
    get-all-droplet-metrics: ''
    get-volume-metrics: ''
    get-app-metrics: ''
    get-load-balancer-metrics: ''
    get-database-metrics: ''
  checks:
    readiness:
      period: 15
      initialDelay: 5
      attempts: 40
  requires:
    - monkec/base
    - digitalocean-monitoring/do-provider-base
    - digitalocean-monitoring/common
    - cli
