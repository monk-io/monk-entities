namespace: redis-cloud
essentials-database:
  defines: entity
  metadata:
    name: EssentialsDatabase
  schema:
    account_key_secret:
      type: string
      minLength: 1
      maxLength: 24
    user_key_secret:
      type: string
      minLength: 1
      maxLength: 24
    name:
      type: string
      minLength: 1
      maxLength: 40
    subscription_id:
      type: string
      minLength: 1
    protocol:
      type: string
      enum:
        - redis
        - memcached
        - stack
    dataset_size_in_gb:
      type: number
      minimum: 0
    memory_limit_in_gb:
      type: number
      minimum: 0
    support_oss_cluster_api:
      type: boolean
    redis_version:
      type: string
    resp_version:
      type: string
      enum:
        - resp2
        - resp3
    use_external_endpoint_for_oss_cluster_api:
      type: boolean
    enable_database_clustering:
      type: boolean
    number_of_shards:
      type: number
    data_persistence:
      type: string
      enum:
        - none
        - aof-every-1-second
        - aof-every-write
        - snapshot-every-1-hour
        - snapshot-every-6-hours
        - snapshot-every-12-hours
    data_eviction_policy:
      type: string
      enum:
        - allkeys-lru
        - allkeys-lfu
        - allkeys-random
        - volatile-lru
        - volatile-lfu
        - volatile-random
        - volatile-ttl
        - noeviction
    replication:
      type: boolean
    periodic_backup_path:
      type: string
    source_ips:
      type: array
      items:
        type: string
    regex_rules:
      type: array
      items:
        type: string
    replica:
      type: object
      properties:
        uris:
          type: array
          items:
            type: string
        encryptionInTransit:
          type: boolean
      additionalProperties: false
    client_tls_certificates:
      type: array
      items:
        type: object
        properties:
          name:
            type: string
          certificate:
            type: string
        required:
          - certificate
        additionalProperties: false
    enable_tls:
      type: boolean
    password:
      type: string
    password_secret:
      type: string
    alerts:
      type: array
      items:
        type: object
        properties:
          name:
            type: string
          value:
            type: number
        required:
          - name
          - value
        additionalProperties: false
    modules:
      type: array
      items:
        type: object
        properties:
          name:
            type: string
          parameters:
            type: object
            additionalProperties: {}
        required:
          - name
        additionalProperties: false
    required:
      - account_key_secret
      - user_key_secret
      - name
      - subscription_id
  lifecycle:
    sync: <<< essentials-database-sync.js
  checks:
    readiness:
      period: 5
      initialDelay: 2
      attempts: 10
  requires:
    - monkec/base
    - monkec/http-client
    - redis-cloud/common
    - secret
    - cli
